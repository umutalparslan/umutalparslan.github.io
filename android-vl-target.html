<!DOCTYPE html>
<html lang="en">
<head>
    <title>Android Visilabs Documentation</title>
    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">    
    <link rel="shortcut icon" href="favicon.ico">  
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <!-- FontAwesome JS -->
    <script defer src="assets/fontawesome/js/all.js"></script>
    <!-- Global CSS -->
    <link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.min.css">   
    <!-- Plugins CSS -->    
    <link rel="stylesheet" href="assets/plugins/prism/prism.css">
    <link rel="stylesheet" href="assets/plugins/elegant_font/css/style.css">  
      
    <!-- Theme CSS -->
    <link id="theme-style" rel="stylesheet" href="assets/css/styles.css">
    
</head> 

<body class="body-green">
    <div class="page-wrapper">
        <!-- ******Header****** -->
        <header id="header" class="header">
            <div class="container">
                <div class="branding">
                    <h1 class="logo">
                        <a href="index.html">
                            <img aria-hidden="true" src="assets/images/android-logo.svg" width="25"/>
                            <span class="text-bold" style="vertical-align: middle;">Android Visilabs Targeting Actions</span>
                        </a>
                    </h1>
                    
                </div><!--//branding-->
                
            </div><!--//container-->
        </header><!--//header-->
        <div class="doc-wrapper">
            <div class="container">
                
                <div class="doc-body row">
                    <div class="doc-content col-md-9 col-12 order-1">
                        <div class="content-inner">
                            <section id="inapp-messaging" class="doc-section">
                                <h2 class="section-title">In-App Messaging</h2>
                                <div class="section-block">
                                    <p>In-App Messages are notifications sent to your users when they are directly active in your mobile application.
                                    </p>
                                    <p>Use the following method to show in-app messages and initialize the RMC:</p>
                                    <pre><code class="language-java">Visilabs.CreateAPI("OrganizationID", "SiteID", "http://lgr.visilabs.net", "DataSource", "http://rt.visilabs.net" , "Android" , getApplicationContext(), "http://s.visilabs.net/json", "http://s.visilabs.net/actjson", requestTimeout);</code></pre>
                                    <p>Add the required getActivity() parameter to all customEvent() calls:</p>
                                    <pre><code class="language-java">HashMap&lt;String,String&gt; parameters = new HashMap&lt;String, String&gt;();
parameters.put("OM.exVisitorID", "test@visilabs.com");
parameters.put("OM.sys.AppID", "visilabs"); //

Visilabs.CallAPI().customEvent("android-visilab", parameters, getActivity());</code></pre>
<p>The existence of a relevant in-app message for an event controlled by after each customEvent call. You can create and customize your in-app messages on https://intelligence.relateddigital.com/#Target/TargetingAction/TAList page of RMC administration panel.
</p>
<p>There are 9 types of in-app messages:</p>
    <p>
        <table>
            <thead>
            <tr>
            <th align="center">Pop-up - Image, Header, Text &amp; Button</th>
            <th>Mini-icon&amp;text</th>
            <th>Full Screen-image</th>
            </tr>
            </thead>
            <tbody>
            <tr>
            <td align="center"><a target="_blank" rel="noopener noreferrer" href="assets/images/full.png"><img src="assets/images/full.png" alt="full" style="max-width:100%;"></a></td>
            <td><a target="_blank" rel="noopener noreferrer" href="assets/images/mini.png"><img src="assets/images/mini.png" alt="mini" style="max-width:100%;"></a></td>
            <td><a target="_blank" rel="noopener noreferrer" href="assets/images/full_image.png"><img src="assets/images/full_image.png" alt="full_image" style="max-width:100%;"></a></td>
            </tr>
            <tr>
            <th align="center">Full Screen-image&amp;button</th>
            <th>Pop-up - Image, Header, Text &amp; Button</th>
            <th>Pop-up-Survey</th>
            </tr>
            <tr>
            <td align="center"><a target="_blank" rel="noopener noreferrer" href="assets/images/image_button.png"><img src="assets/images/image_button.png" alt="image_button" style="max-width:100%;"></a></td>
            <td><a target="_blank" rel="noopener noreferrer" href="assets/images/image_text_button.png"><img src="assets/images/image_text_button.png" alt="image_text_button" style="max-width:100%;"></a></td>
            <td><a target="_blank" rel="noopener noreferrer" href="assets/images/smile_rating.png"><img src="assets/images/smile_rating.png" alt="smile_rating" style="max-width:100%;"></a></td>
            </tr>
            <tr>
            <th align="center">Pop-up - NPS with Text &amp; Button</th>
            <th>Native Alert &amp; Actionsheet</th>
            <th>NPS with numbers</th>
            </tr>
            <tr>
            <td align="center"><a target="_blank" rel="noopener noreferrer" href="assets/images/nps.png"><img src="assets/images/nps.png" alt="nps" style="max-width:100%;"></a></td>
            <td><a target="_blank" rel="noopener noreferrer" href="assets/images/alert.png"><img src="assets/images/alert.png" alt="nps_with_numbers" style="max-width:100%;"></a></td>
            <td><a target="_blank" rel="noopener noreferrer" href="assets/images/nps_with_numbers.png"><img src="assets/images/nps_with_numbers.png" alt="nps_with_numbers" style="max-width:100%;"></a></td>
            </tr>
            </tbody>
            </table>
    </p>
                                </div>
                            </section><!--//doc-section-->
                            <section id="favorite-attribute-actions" class="doc-section">
                                <h2 class="section-title">Favorite Attribute Actions</h2>
                                    
                                    <p>You can access favorite attributes of the Targeting Actions of type Favorite Attribute Action that you defined from the https://intelligence.relateddigital.com/#Target/TargetingAction/TAList/ section on the RMC panel via the mobile application as follows.
                                    </p>
                                    <div class="code-block">
<pre><code class="language-java">@Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
    
    
    //requestAction() or requestActionId()
      try {
            VisilabsActionRequest visilabsActionRequest = Visilabs.CallAPI().requestAction(VisilabsConstant.FavoriteAttributeAction);
            visilabsActionRequest.executeAsyncAction(getVisilabsCallback());
        } catch (Exception e) {
            e.printStackTrace();
        }
        }</code></pre>
                                    </div><!--//code-block-->

<div class="code-block">
<pre><code class="language-java">public VisilabsCallback getVisilabsCallback() {

    return new VisilabsCallback() {
        @Override
        public void success(VisilabsResponse response) {
            try {
                FavsResponse favsResponse = new Gson().fromJson(response.getRawResponse(), FavsResponse.class);
                String favBrands = favsResponse.getFavoriteAttributeAction()[0].getActiondata().getFavorites().getBrand()[0];
                Log.i("Favs 1.Brand", favBrands);
            } catch (Exception ex) {
                Log.e("Error", ex.getMessage(), ex);
            }
        }

        @Override
        public void fail(VisilabsResponse response) {
            Log.d("Error", response.getRawResponse());
        }
    };
}</code></pre>

<p>or</p>
<pre><code class="language-java">private VisilabsFavsRequestCallback getVisilabsCallback() {
    return new VisilabsFavsRequestCallback() {
        @Override
        public void success(FavsResponse message, String url) {
            Log.i(LOG_TAG, "Success Request : " + url);
            //Do your work here by using message, e.g.
            /*
            List&lt;FavoriteAttributeAction&gt; favsActions = message.getFavoriteAttributeAction();
            for (int i = 0; i &lt; favsActions.size() ; i++) {
                String actionType = favsActions.get(i).getActiontype();
                Log.i(LOG_TAG, "action type " + i+1 + " : " + actionType);
                Actiondata  actionData = favsActions.get(i).getActiondata();
                for (int j = 0; j &lt; favsActions.size() ; j++) {
                    String[] attributes = actionData.getAttributes();
                    Favorites favorites = actionData.getFavorites();
                    //goes on...
                }
            }
            */
        }
        @Override
        public void fail(Throwable t, String url) {
            Log.e(LOG_TAG, "Fail Request : " + url);
            Log.e(LOG_TAG, "Fail Request Message : " + t.getMessage());
        }
    };
}</code></pre>
                                    </div>
                                    
                            </section><!--//doc-section-->
                            <section id="story-actions" class="doc-section">
                                <h2 class="section-title">Story Actions</h2>
                                <p>Place the following VisilabsRecyclerView the desired section of the layout for the implementation of both actions.
                                    </p>
<pre><code class="language-java">&lt;com.visilabs.story.VisilabsRecyclerView
    android:id="@+id/vrv_story"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"/></code></pre>
                                    <p>After defining the VisilabsRecyclerView in your class, define the StoryItemClickListener and define the orientation or action you want to do when clicking each story. Toast Message is shown here for an example.

                                        Then call the VisilabsRecyclerView's setStoryAction method and add the storyItemClickListener object to the method.</p>
                                    
<pre><code class="language-java">VisilabsRecyclerView visilabsRecyclerView = findViewById(R.id.vrv_story);

    StoryItemClickListener storyItemClickListener = new StoryItemClickListener() {
         @Override
         public void storyItemClicked(String storyLink) {
             Toast.makeText(getApplicationContext(), storyLink, Toast.LENGTH_LONG).show();
         }
     };

    visilabsRecyclerView.setStoryAction(getApplicationContext(), storyItemClickListener);

</code></pre>
<p>You can also set it with Story Action Id.</p>
<pre><code class="language-java">visilabsRecyclerView.setStoryActionId(getApplicationContext(), "250", storyItemClickListener);</code></pre>
<p>It will appear in your application as long as there is an active story looking banner or story on the panel.</p>
                            </section>

                            <section id="mail-subscription-form" class="doc-section">
                                <h2 class="section-title">Mail Subscription Form</h2>
                                <p>After form is created at RMC panel, likewise in-app message, existence of mail subscription form is controlled by after each customEvent call. It is shown as follows. You need to call overload, which takes Activity in the customEvent parameter. Sample code and visual;
                                    </p>
                                    <pre><code class="language-java">customEvent(String pageName, HashMap&lt;String, String> properties, Activity parent)</code></pre>
                                    <div style="text-align: center;"><img src="assets/images/mailsubs-android.png" style="width: 100%;max-width: 300px;"></div>
                            </section>

                            <section id="spin-to-win" class="doc-section">
                                <h2 class="section-title">Spin To Win</h2>
                                <p>After form is created at RMC panel, likewise in-app message, existence of spin to win is controlled by after each customEvent call. It is shown as follows. You need to call overload, which takes Activity in the customEvent parameter. Sample code and visual;
                                    </p>
                                    <pre><code class="language-java">customEvent(String pageName, HashMap<String, String> properties, Activity parent)</code></pre>
                                    <p>
                                        <table>
                                            <tbody>
                                                <tr>
                                                    <td>Spin to Win Full</td>
                                                    <td>Spin to Win Half</td>
                                                </tr>
                                                <tr>
                                                    <td><img src="assets/images/spinfull.jpeg" style="max-width:100%;"/></td>
                                                    <td><img src="assets/images/spinhalf.jpeg" style="max-width:100%;"/></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </p>
                            </section>

                            <section id="recommendation" class="doc-section">
                                <h2 class="section-title">Recommendation</h2>
                                <p>You can find the documents required to show personalized product recommendations in your Android mobile application in this section.
                                    </p>
                                    <div class="callout-block callout-info">
                                        <div class="icon-holder">
                                            <i class="fas fa-info-circle"></i>
                                        </div><!--//icon-holder-->
                                        <div class="content">
                                            <strong>Create a VisilabsTargetRequest object and call the executeAsync method of the VisilabsTargetRequest object.</strong>
                                        </div>
                                    </div>
                                    <div class="callout-block callout-info">
                                        <div class="icon-holder">
                                            <i class="fas fa-info-circle"></i>
                                        </div><!--//icon-holder-->
                                        <div class="content">
                                            <strong>ZoneID is different for each application, so contact RMC team for support. Suggestion widgets such as "Alternative Products" require the product code to be seen as a parameter.</strong>
                                        </div>
                                    </div>
                                    <p>
                                        The specification of the callback function is as follows:
                                    </p>
                                    <div class="code-block">
                                        <pre>
<code class="language-java">VisilabsTargetRequest targetRequest = Visilabs.CallAPI().buildTargetRequest(zoneID, "productCode");
    targetRequest.executeAsync(callback);</code>
                                        </pre>
                                    </div>
                                    <p>There is also an overload buildTargetRequest method with which you can pass filters and additional parameters.</p>
                                    <div class="code-block">
<pre>
<code class="language-java">List filters = new ArrayList&lt;VisilabsTargetFilter&gt;();

    HashMap&lt;String,String&gt; properties = new HashMap&lt;String, String&gt;();
    properties.put("OM.extra", "Extra Value");
    VisilabsTargetFilter f = new VisilabsTargetFilter();
    f.setAttribute("attr1");
    f.setFilterType("0"); // There are 2 filter types: Include and Exclude. For Include pass "0", for Exclude pass "1".
    f.setValue("value");
    filters.add(f);
    f = new VisilabsTargetFilter();
    f.setAttribute("attr2");
    f.setFilterType("1"); // There are 2 filter types: Include and Exclude. For Include pass "0", for Exclude pass "1".
    f.setValue("value");
    filters.add(f);
    VisilabsTargetRequest targetRequest = Visilabs.CallAPI().buildTargetRequest(zoneID, "productCode", properties, filters);
    targetRequest.executeAsync(callback);</code>
</pre>
                                    </div>
                                    <p>
                                        After the request is completed, the callback function is called depending on the success or failure of the request, so you need to code the callback functions according to your needs as shown below:
                                    </p>
                                    <div class="code-block">
                                        <pre>
<code class="language-java">
    VisilabsTargetCallback callback = new VisilabsTargetCallback() {
        @Override
        public void success(VisilabsResponse response) {
        try{
        JSONArray array = response.getArray();
        if(array != null) {
        ArrayList&lt;Product&gt; recommendations = new ArrayList&lt;&gt;();
        for (int i = 0; i &lt; array.length(); i++) {
        JSONObject obj = (JSONObject)array.get(i);
        Product product = new Product();
        product.setProductCode(obj.getString("code"));
        product.setProductName(obj.getString("title"));
        product.setMediumImageUrl(obj.getString("img"));
        product.setProductURL(obj.getString("dest_url"));
        product.setBrand(obj.getString("brand"));
        product.setOriginalPrice(obj.getDouble("price"));
        product.setDiscountedPrice(obj.getDouble("dprice"));
        product.setCurrency(obj.getString("cur"));
        product.setDiscountCurrency(obj.getString("dcur"));
        product.setFreeShipping(obj.getBoolean("freeshipping")); 
        product.setShippingOnSameDay
        (obj.getBoolean("samedayshipping"));
        product.setRating(obj.getInt("rating"));
        product.setComment(obj.getInt("comment"));
        product.setDiscountRate(obj.getDouble("discount")); 
        product.setAttr1(obj.getString("attr1"));
        product.setAttr2(obj.getString("attr2"));
        product.setAttr3(obj.getString("attr3"));
        product.setAttr4(obj.getString("attr4"));
        product.setAttr5(obj.getString("attr5"));
        recommendations.add(product);
        } 
        }
        }catch (Exception ex){
        showToast(ex.getMessage());
        Log.e(LOG_TAG, ex.getMessage(), ex);
        }
        }
        @Override
        public void fail(VisilabsResponse response) {
        showToast(response.getErrorMessage());
        Log.d(LOG_TAG, rawResponse);
        }
        };
</code>
                                        </pre>
                                    </div>
                            </section>

                        </div><!--//content-inner-->
                    </div><!--//doc-content-->
                    <div class="doc-sidebar col-md-3 col-12 order-0 d-none d-md-flex">
                        <div id="doc-nav" class="doc-nav">
	                        
	                            <nav id="doc-menu" class="nav doc-menu flex-column sticky">
	                                <a class="nav-link scrollto" href="#inapp-messaging">In-App Messaging</a>
	                                <a class="nav-link scrollto" href="#favorite-attribute-actions">Favorite Attribute Actions</a>
                                    <a class="nav-link scrollto" href="#story-actions">Story Actions</a>
	                                <a class="nav-link scrollto" href="#mail-subscription-form">Mail Subscription Form</a>
	                                <a class="nav-link scrollto" href="#spin-to-win">Spin to Win</a>
	                                <a class="nav-link scrollto" href="#recommendation">Recommendation</a>
	                                <a class="nav-link other-page" href="/android-vl-setup.html">Android Visilabs Setup & Data Collection</a>
	                            </nav><!--//doc-menu-->
	                        
                        </div>
                    </div><!--//doc-sidebar-->
                </div><!--//doc-body-->              
            </div><!--//container-->
        </div><!--//doc-wrapper-->
        
    </div><!--//page-wrapper-->
    
    <footer id="footer" class="footer text-center">
        <div class="container">
            <!--/* This template is free as long as you keep the footer attribution link. If you'd like to use the template without the attribution link, you can buy the commercial license via our website: themes.3rdwavemedia.com Thank you for your support. :) */-->
            <small class="copyright">Related Digital - All Rights Reserved</small>
            
        </div><!--//container-->
    </footer><!--//footer-->
    
     
    <!-- Main Javascript -->          
    <script type="text/javascript" src="assets/plugins/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="assets/plugins/prism/prism.js"></script>    
    <script type="text/javascript" src="assets/plugins/jquery-scrollTo/jquery.scrollTo.min.js"></script>      
    <script type="text/javascript" src="assets/plugins/stickyfill/dist/stickyfill.min.js"></script>                                                             
    <script type="text/javascript" src="assets/js/main.js"></script>
    
</body>
</html> 

